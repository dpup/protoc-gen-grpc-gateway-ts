{{if not .EnableStylingCheck -}}
/* eslint-disable */
// @ts-nocheck
{{- else -}}
/* eslint-disable @typescript-eslint/consistent-type-definitions */
{{- end}}

/**
 * This file is a generated Typescript file for GRPC Gateway, DO NOT MODIFY
 */

{{if .HasDependencies -}}
{{- range .Dependencies -}}
  import * as {{.ModuleIdentifier}} from "{{.SourceFile}}";
{{end}}
{{end -}}

{{- if .NeedsOneOfSupport -}}
type Absent<T, K extends keyof T> = { [k in Exclude<keyof T, K>]?: undefined };

type OneOf<T> =
  | { [k in keyof T]?: undefined }
  | (keyof T extends infer K
      ? K extends string & keyof T
        ? { [k in K]: T[K] } & Absent<T, K>
        : never
      : never);
{{end -}}

{{- if .NeedsStructPBSupport}}
type StructPBValue =
  | null
  | boolean
  | string
  | number
  | { [key: string]: StructPBValue }
  | StructPBValue[];
{{end -}}

{{- range .Enums -}}
  {{- include "enum" . -}}
{{- end -}}

{{- range .Messages}}
  {{- include "message" . -}}
  {{- if .HasBytesFields -}}
    {{- include "message_decoder" . -}}
  {{- end -}}
{{- end}}

{{- if .UseStaticClasses -}}
  {{- range .Services }}
    {{- template "static_service" (dict "Service" . "Messages" $.Messages) -}}
  {{- end}}
{{- else -}}
  {{- range .Services }}
    {{- template "service_client" (dict "Service" . "Messages" $.Messages) -}}
  {{- end}}
{{- end }}


{{define "enum"}}
export enum {{.Name}} {
  {{- range .Values}}
  {{.}} = "{{.}}",
  {{- end}}
}
{{end}}


{{define "message"}}
{{if .IsDeprecated -}}
/**
 * @deprecated This message has been deprecated.
 */
{{end -}}
{{- if .HasOneOfFields -}}
type Base{{.Name}} = {
{{- range .NonOneOfFields}}
  {{if .IsDeprecated -}}
  /** @deprecated This field has been deprecated. */
  {{end -}}
  {{tsTypeKey .}}: {{tsTypeDef .}};
{{- end}}
{{- range .OptionalFields -}}
  {{if .IsDeprecated -}}
  /** @deprecated This field has been deprecated. */
  {{end -}}
  {{tsTypeKey .}}: {{tsTypeDef .}};
{{- end}}
};

export type {{.Name}} = Base{{.Name}}
{{- range $groupId, $fields := .OneOfFieldsGroups}} &
  OneOf<{
{{- range $index, $field := $fields}}
    {{if $field.IsDeprecated -}}
    /** @deprecated This field has been deprecated. */
    {{end -}}
    {{fieldName $field.Name}}: {{tsType $field}};
{{- end}}
  }>
{{- end -}};

{{/* Standard, non oneof messages */}}

{{- else -}}
{{- if eq (len .Fields) 0 -}}
  export type {{.Name}} = Record<string, never>;
{{- else -}}
  export type {{.Name}} = {
{{- range .Fields}}
  {{if .IsDeprecated -}}
  /** @deprecated This field has been deprecated. */
  {{end -}}
  {{tsTypeKey .}}: {{tsTypeDef .}};
{{- end}}
};
    {{- end -}}
  {{- end}}
{{end}}


{{define "static_service"}}
export class {{.Service.Name}} {
{{- range .Service.Methods}}
  /**
   * {{.TSMethodName}} - {{.HTTPMethod}} {{.URL}}
   */
{{- if .ServerStreaming }}
  static {{.TSMethodName}}(this:void, req: {{tsType .Input}}, entityNotifier?: fm.NotifyStreamEntityArrival<{{tsType .Output}}>, initReq?: fm.InitReq): Promise<void> {
    return fm.fetchStreamingRequest<{{tsType .Output}}>(`{{renderURL .}}`, entityNotifier, {...initReq, {{buildInitReq .}}});
  }
{{- else }}
  static {{.TSMethodName}}(this:void, req: {{tsType .Input}}, initReq?: fm.InitReq): Promise<{{tsType .Output}}> {
    return fm.fetchRequest<{{tsType .Output}}>(`{{renderURL .}}`, {...initReq, {{buildInitReq .}}})
    {{- $outputType := tsType .Output -}}
    {{- range $.Messages -}}
      {{- if and .HasBytesFields (eq .Name $outputType) -}}
      .then(decode{{.Name}})
      {{- end -}}
    {{- end}};
  }
{{- end}}
{{- end}}
}

{{end}}

{{define "service_client"}}
{{- range .Service.Methods}}
/**
 * {{functionCase .TSMethodName}} - {{.HTTPMethod}} {{.URL}}
 */
{{- if .ServerStreaming }}
export function {{functionCase .TSMethodName}}(req: {{tsType .Input}}, entityNotifier?: fm.NotifyStreamEntityArrival<{{tsType .Output}}>, initReq?: fm.InitReq): Promise<void> {
  return fm.fetchStreamingRequest<{{tsType .Output}}>(`{{renderURL .}}`, entityNotifier, {...initReq, {{buildInitReq .}}});
}
{{- else }}
export function {{functionCase .TSMethodName}}(req: {{tsType .Input}}, initReq?: fm.InitReq): Promise<{{tsType .Output}}> {
  return fm.fetchRequest<{{tsType .Output}}>(`{{renderURL .}}`, {...initReq, {{buildInitReq .}}})
  {{- $outputType := tsType .Output -}}
  {{- range $.Messages -}}
    {{- if and .HasBytesFields (eq .Name $outputType) -}}
    .then(decode{{.Name}})
    {{- end -}}
  {{- end}};
}
{{- end}}
{{end}}
export class {{.Service.Name}}Client {
  private initReq?: fm.InitReq;
  constructor(initReq?: fm.InitReq) {
    this.initReq = initReq;
  }
  {{- range .Service.Methods}}
  /**
   * {{functionCase .TSMethodName}} - {{.HTTPMethod}} {{.URL}}
   */
  {{- if .ServerStreaming }}
  {{functionCase .TSMethodName}}(req: {{tsType .Input}}, entityNotifier?: fm.NotifyStreamEntityArrival<{{tsType .Output}}>, initReq?: fm.InitReq): Promise<void> {
    return {{functionCase .TSMethodName}}(req, entityNotifier, {...this.initReq, ...initReq});
  }
  {{- else }}
  {{functionCase .TSMethodName}}(req: {{tsType .Input}}, initReq?: fm.InitReq): Promise<{{tsType .Output}}> {
    return {{functionCase .TSMethodName}}(req, {...this.initReq, ...initReq});
  }
  {{- end }}
  {{- end}}
}

{{end}}

{{define "message_decoder"}}
type {{.Name}}JSON = {
{{- range .Fields}}
{{- if eq .Type "bytes"}}
{{- if .IsRepeated}}
  {{tsTypeKey .}}: string[];
{{- else}}
  {{tsTypeKey .}}: string;
{{- end}}
{{- else}}
  {{tsTypeKey .}}: {{tsTypeDef .}};
{{- end}}
{{- end}}
};

export function decode{{.Name}}(json: {{.Name}}JSON): {{.Name}} {
  return {
{{- range .Fields}}
{{- if eq .Type "bytes"}}
{{- if .IsRepeated}}
    {{fieldName .Name}}: json.{{fieldName .Name}} != null ? json.{{fieldName .Name}}.map((x: string) => fm.b64Decode(x)) : undefined,
{{- else}}
    {{fieldName .Name}}: json.{{fieldName .Name}} != null ? fm.b64Decode(json.{{fieldName .Name}}) : undefined,
{{- end}}
{{- else}}
    {{fieldName .Name}}: json.{{fieldName .Name}},
{{- end}}
{{- end}}
  };
}

{{end}}